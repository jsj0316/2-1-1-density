<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가상 과학 실험실 : I. 물질의 특성 - 1. 밀도</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f4f8; }
        .cylinder-gradient {
            background: linear-gradient(90deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.4) 100%);
            border-left: 1px solid rgba(255,255,255,0.5);
            border-right: 1px solid rgba(255,255,255,0.5);
        }
        .water-surface {
            transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .liquid-layer {
            transition: all 0.8s ease-in-out;
        }
        .ocean-gradient {
            background: linear-gradient(to bottom, #7dd3fc 0%, #38bdf8 15%, #0284c7 50%, #0c4a6e 100%);
        }
        .diver-anim {
            transition: top 2.5s cubic-bezier(0.45, 0.05, 0.55, 0.95);
        }
        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: rise 4s infinite ease-in;
        }
        @keyframes rise {
            0% { bottom: -10px; opacity: 0; transform: translateX(0); }
            50% { opacity: 1; }
            100% { bottom: 100%; opacity: 0; transform: translateX(-20px); }
        }
        .ship-float {
            animation: ship-move 4s ease-in-out infinite;
        }
        @keyframes ship-move {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-3px) rotate(1deg); }
        }
        /* Mixing Animation */
        @keyframes mix-shake {
            0% { transform: translate(0, 0); }
            10% { transform: translate(-2px, -2px); }
            20% { transform: translate(2px, 2px); }
            30% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            50% { transform: translate(-1px, 1px); }
            60% { transform: translate(1px, -1px); }
            70% { transform: translate(0, 2px); }
            80% { transform: translate(-2px, 0); }
            90% { transform: translate(1px, 1px); }
            100% { transform: translate(0, 0); }
        }
        .mixing .liquid-layer {
            animation: mix-shake 0.5s infinite;
            filter: blur(1px);
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icon Components ---
        const Icon = ({ size = 24, color = "currentColor", children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Beaker = (props) => ( <Icon {...props}><path d="M4.5 3h15" /><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3" /><path d="M6 14h12" /></Icon> );
        const FlaskConical = (props) => ( <Icon {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2" /><path d="M8.5 2h7" /><path d="M7 16h10" /></Icon> );
        const Info = (props) => ( <Icon {...props}><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></Icon> );
        const RefreshCcw = (props) => ( <Icon {...props}><path d="M3 2v6h6" /><path d="M21 12A9 9 0 0 0 6 5.3L3 8" /><path d="M21 22v-6h-6" /><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7" /></Icon> );
        const Droplets = (props) => ( <Icon {...props}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z" /><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35" /></Icon> );
        const Waves = (props) => ( <Icon {...props}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" /><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" /><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" /></Icon> );
        const Thermometer = (props) => ( <Icon {...props}><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z" /></Icon> );
        const CircleDashed = (props) => ( <Icon {...props}><path d="M10.1 2.182a10 10 0 0 1 3.8 0" /><path d="M17.609 3.721a10 10 0 0 1 2.69 2.7" /><path d="M21.818 10.1a10 10 0 0 1 0 3.8" /><path d="M20.279 17.609a10 10 0 0 1-2.7 2.69" /><path d="M13.9 21.818a10 10 0 0 1-3.8 0" /><path d="M6.391 20.279a10 10 0 0 1-2.69-2.7" /><path d="M2.182 13.9a10 10 0 0 1 0-3.8" /><path d="M3.721 6.391a10 10 0 0 1 2.7-2.69" /></Icon> );

        // --- Data ---
        const MATERIALS = [
            { id: 'iron_s', name: '철 조각 (소)', color: '#64748b', mass: 39.35, volume: 5, density: 7.87, size: 'small' },
            { id: 'iron_l', name: '철 조각 (대)', color: '#475569', mass: 78.7, volume: 10, density: 7.87, size: 'large' },
            { id: 'alu_s', name: '알루미늄 (소)', color: '#cbd5e1', mass: 13.5, volume: 5, density: 2.70, size: 'small' },
            { id: 'alu_l', name: '알루미늄 (대)', color: '#94a3b8', mass: 27.0, volume: 10, density: 2.70, size: 'large' },
            { id: 'mystery_a', name: '미지의 물질 A', color: '#fbbf24', mass: 96.6, volume: 5, density: 19.32, size: 'small' }, 
            { id: 'mystery_b', name: '미지의 물질 B', color: '#10b981', mass: 89.6, volume: 10, density: 8.96, size: 'large' }, 
        ];

        const LIQUIDS = [
            { id: 'honey', name: '꿀', density: 1.42, color: '#d97706', textColor: 'white' },
            { id: 'soap', name: '주방세제', density: 1.06, color: '#ec4899', textColor: 'white' },
            { id: 'water', name: '물', density: 1.00, color: '#3b82f6', textColor: 'white' },
            { id: 'oil', name: '식용유', density: 0.92, color: '#eab308', textColor: 'black' },
            { id: 'alcohol', name: '에탄올', density: 0.79, color: '#a855f7', textColor: 'white' },
        ];

        // --- Graphic Components ---
        const RealisticDiver = ({ weightCount }) => (
            <svg width="100" height="120" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                <rect x="35" y="30" width="20" height="45" rx="10" fill="#fbbf24" stroke="#d97706" strokeWidth="1" />
                <path d="M40 25 Q50 20 60 25 L65 70 Q50 80 35 70 Z" fill="#1e293b" />
                <circle cx="50" cy="20" r="12" fill="#334155" />
                <rect x="42" y="15" width="16" height="8" rx="2" fill="#94a3b8" />
                <path d="M40 30 L25 50" stroke="#1e293b" strokeWidth="8" strokeLinecap="round" />
                <path d="M60 30 L75 50" stroke="#1e293b" strokeWidth="8" strokeLinecap="round" />
                <path d="M42 70 L35 95" stroke="#1e293b" strokeWidth="8" strokeLinecap="round" />
                <path d="M58 70 L65 95" stroke="#1e293b" strokeWidth="8" strokeLinecap="round" />
                <rect x="38" y="65" width="24" height="6" fill="#475569" rx="1" />
                {[...Array(weightCount)].map((_, i) => (
                    <rect key={i} x={40 + i*4} y={66} width="3" height="4" fill="#1e293b" rx="0.5" />
                ))}
            </svg>
        );

        const LifeJacketPerson = () => (
            <div className="relative animate-bounce-slight" style={{ animationDuration: '3s' }}>
                <svg width="60" height="80" viewBox="0 0 60 80">
                    <circle cx="30" cy="20" r="10" fill="#fecaca" />
                    <rect x="15" y="30" width="30" height="25" rx="5" fill="#f97316" />
                    <rect x="20" y="32" width="20" height="20" rx="2" fill="#fb923c" />
                </svg>
            </div>
        );

        const SimpleShip = () => (
            <div className="ship-float">
                <svg width="120" height="60" viewBox="0 0 120 60">
                    <path d="M10 40 L110 40 L100 60 L20 60 Z" fill="#e2e8f0" stroke="#94a3b8" strokeWidth="2" />
                    <rect x="40" y="15" width="40" height="25" fill="white" stroke="#94a3b8" strokeWidth="2" />
                    <rect x="50" y="5" width="10" height="15" fill="#475569" />
                </svg>
            </div>
        );

        // --- Tab 1: Explore ---
        const ExperimentLab = () => {
            const [selectedObj, setSelectedObj] = useState(null);
            const [scaleValue, setScaleValue] = useState(0);
            const [onScale, setOnScale] = useState(null);
            const [baseWaterVolume, setBaseWaterVolume] = useState(50.0);
            const [inCylinder, setInCylinder] = useState(null);
            const [message, setMessage] = useState("실험할 물질을 클릭해주세요.");
            const [temperature, setTemperature] = useState(20);

            const currentWaterVolume = baseWaterVolume + (baseWaterVolume * 0.0004 * (temperature - 20));
            const totalVolume = currentWaterVolume + (inCylinder ? inCylinder.volume : 0);

            const handleSelect = (obj) => {
                if (inCylinder || onScale) return;
                setSelectedObj(obj);
                setMessage(`${obj.name} 선택됨. 측정 도구를 선택하세요.`);
            };

            const placeOnScale = () => {
                if (!selectedObj) return;
                setOnScale(selectedObj);
                setSelectedObj(null);
                setTimeout(() => setScaleValue((selectedObj.mass).toFixed(2)), 400);
            };

            const placeInCylinder = () => {
                if (!selectedObj) return;
                setInCylinder(selectedObj);
                setSelectedObj(null);
            };

            const resetExperiment = () => {
                setOnScale(null);
                setInCylinder(null);
                setSelectedObj(null);
                setScaleValue(0);
                setMessage("실험이 초기화되었습니다. 실험할 물질을 클릭해주세요.");
            };

            return (
                <div className="flex flex-col lg:flex-row h-full gap-4 p-4">
                    <div className="flex-1 bg-white rounded-2xl shadow-lg p-6 flex flex-col relative overflow-hidden">
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <FlaskConical className="text-blue-600" /> 
                                탐구: 질량과 부피를 측정하여 철과 알루미늄 구별하기
                            </h2>
                            <div className="bg-orange-50 p-2 rounded-lg border border-orange-200 flex items-center gap-3">
                                <Thermometer className="text-orange-500" size={20} />
                                <div className="flex flex-col">
                                    <span className="text-xs text-orange-800 font-bold">물의 온도: {temperature}°C</span>
                                    <input type="range" min="0" max="80" value={temperature} onChange={(e) => setTemperature(parseInt(e.target.value))} className="w-32 h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer" />
                                </div>
                            </div>
                        </div>
                        <div className="flex-1 flex flex-row justify-around items-end gap-8 pb-4">
                            <div className="flex flex-col items-center relative z-10 w-48">
                                <div className="w-full h-8 bg-gray-400 rounded-lg shadow-md mt-auto"></div>
                                <div className="w-40 h-4 bg-gray-300 rounded-t-lg mx-auto relative -mt-12 mb-2">
                                    {onScale && <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 shadow-lg mb-0" style={{ backgroundColor: onScale.color, width: onScale.size === 'large' ? '48px' : '32px', height: onScale.size === 'large' ? '48px' : '32px', borderRadius: '4px' }}></div>}
                                </div>
                                <div className="bg-gray-800 text-green-400 font-mono text-2xl px-4 py-2 rounded-lg border-4 border-gray-300 shadow-inner w-full text-center mt-4">{scaleValue} <span className="text-sm">g</span></div>
                                <span className="text-gray-500 text-sm mt-2 font-medium">전자 저울</span>
                                {selectedObj && !onScale && !inCylinder && <button onClick={placeOnScale} className="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-3 py-1 rounded shadow text-sm animate-pulse whitespace-nowrap">올리기</button>}
                            </div>
                            <div className="flex flex-col items-center relative w-32">
                                <div className="relative w-24 h-64 border-l-2 border-r-2 border-b-4 border-gray-400 rounded-b-xl bg-white bg-opacity-50 overflow-hidden cylinder-gradient">
                                    {[...Array(10)].map((_, i) => <div key={i} className="absolute w-full border-t border-gray-300" style={{bottom: `${(i+1)*10}%`}}><span className="absolute right-1 -top-3 text-[10px] text-gray-400">{(i+1)*10}</span></div>)}
                                    <div className="absolute bottom-0 w-full bg-blue-400 bg-opacity-60 water-surface" style={{ height: `${(totalVolume / 100) * 100}%` }}></div>
                                    {inCylinder && <div className="absolute left-1/2 transform -translate-x-1/2 shadow-lg border border-gray-600" style={{ bottom: '10%', backgroundColor: inCylinder.color, width: inCylinder.size === 'large' ? '30px' : '20px', height: inCylinder.size === 'large' ? '30px' : '20px', borderRadius: '4px', transition: 'bottom 1s ease-out' }}></div>}
                                </div>
                                <div className="mt-2 text-center"><div className="font-bold text-blue-800 text-lg">{totalVolume.toFixed(2)} mL</div><span className="text-gray-500 text-sm font-medium">눈금 실린더</span></div>
                                {selectedObj && !onScale && !inCylinder && <button onClick={placeInCylinder} className="absolute top-1/2 -right-12 bg-blue-500 text-white px-3 py-1 rounded shadow text-sm animate-pulse whitespace-nowrap">넣기</button>}
                            </div>
                        </div>
                    </div>
                    <div className="lg:w-80 flex flex-col gap-4">
                        <div className="bg-blue-50 border border-blue-200 p-4 rounded-xl"><h3 className="font-bold text-blue-800 flex items-center gap-2 mb-2"><Info size={18} /> 상태 메시지</h3><p className="text-gray-700 text-sm min-h-[3rem]">{message}</p>{(onScale || inCylinder) && <button onClick={resetExperiment} className="mt-3 w-full bg-red-100 text-red-600 py-2 rounded-lg hover:bg-red-200 font-medium flex items-center justify-center gap-2"><RefreshCcw size={16} /> 실험 도구 비우기</button>}</div>
                        <div className="bg-white p-4 rounded-xl shadow-lg flex-1 flex flex-col">
                            <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">실험 재료</h3>
                            <div className="grid grid-cols-2 gap-3 mb-6">
                                {MATERIALS.map((mat) => (
                                    <div key={mat.id} onClick={() => handleSelect(mat)} className={`cursor-pointer flex flex-col items-center p-2 rounded-lg border hover:scale-105 transition-transform ${selectedObj?.id === mat.id ? 'bg-blue-100 border-blue-500' : 'bg-gray-50'}`}>
                                        <div className="rounded border border-gray-400 mb-2" style={{ backgroundColor: mat.color, width: mat.size === 'large' ? '40px' : '24px', height: mat.size === 'large' ? '40px' : '24px' }}></div>
                                        <span className="text-xs font-medium">{mat.name}</span>
                                    </div>
                                ))}
                            </div>
                            
                            {/* Density Reference Table */}
                            <div className="bg-gray-50 rounded-lg p-3 border border-gray-200 text-xs mt-auto">
                                <h4 className="font-bold text-gray-700 mb-2 flex items-center gap-1 border-b border-gray-200 pb-1">
                                    <Info size={12} /> 참고: 금속의 밀도 (20°C)
                                </h4>
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="text-gray-500">
                                            <th className="py-1 font-normal">물질</th>
                                            <th className="py-1 font-normal text-right">밀도(g/cm³)</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-gray-800">
                                        <tr className="border-t border-gray-200"><td className="py-1">금</td><td className="text-right font-mono">19.30</td></tr>
                                        <tr className="border-t border-gray-200"><td className="py-1">납</td><td className="text-right font-mono">11.34</td></tr>
                                        <tr className="border-t border-gray-200"><td className="py-1">은</td><td className="text-right font-mono">10.49</td></tr>
                                        <tr className="border-t border-gray-200"><td className="py-1">구리</td><td className="text-right font-mono">8.96</td></tr>
                                        <tr className="border-t border-gray-200"><td className="py-1">철</td><td className="text-right font-mono">7.87</td></tr>
                                        <tr className="border-t border-gray-200"><td className="py-1">알루미늄</td><td className="text-right font-mono">2.70</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Tab 2: Do it! ---
        const DensityTower = () => {
            const [layers, setLayers] = useState([]); 
            const [userSequence, setUserSequence] = useState([null, null, null]); 
            const [isSuccess, setIsSuccess] = useState(false);
            const [message, setMessage] = useState("");
            const [isMixing, setIsMixing] = useState(false);

            // Filter for only Water, Oil, Alcohol
            const availableLiquids = LIQUIDS.filter(l => ['water', 'oil', 'alcohol'].includes(l.id));

            const addToTower = (l) => { 
                if (layers.length >= 5 || isMixing) return;
                
                // Add new liquid on top (unsorted initially)
                const newUnsorted = [...layers, l];
                setLayers(newUnsorted);
                setIsMixing(true);

                // Simulate mixing then settling
                setTimeout(() => {
                    const sorted = [...newUnsorted].sort((a,b) => b.density - a.density);
                    setLayers(sorted);
                    setIsMixing(false);
                }, 2000); // 2 seconds mixing
            };

            const addToSequence = (l) => { 
                if(isSuccess) return; 
                const i = userSequence.indexOf(null); 
                if(i !== -1) { 
                    const s = [...userSequence]; 
                    s[i] = l; 
                    setUserSequence(s); 
                    check(s); 
                }
            };

            const removeFromSequence = (index) => {
                if (isSuccess) return;
                const newSeq = [...userSequence];
                newSeq[index] = null;
                setUserSequence(newSeq);
                setIsSuccess(false);
                setMessage("");
            };

            const check = (s) => { 
                if(s.includes(null)) return; 
                let ok = true; 
                for(let i=0; i<s.length-1; i++) if(s[i].density < s[i+1].density) ok = false; 
                if(ok) { 
                    setIsSuccess(true); 
                    setMessage("정답입니다! 각 액체의 밀도 값을 확인해보세요."); 
                } else {
                    setMessage("순서가 틀렸습니다. 다시 실험해 보세요!"); 
                }
            };

            const resetAll = () => {
                setLayers([]);
                setUserSequence([null, null, null]);
                setIsSuccess(false);
                setMessage("");
                setIsMixing(false);
            };

            return (
                <div className="flex flex-col h-full p-4 items-center bg-gray-50 overflow-y-auto">
                    <div className="w-full max-w-4xl mb-6 text-center">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center justify-center gap-2 mb-2">
                            <Droplets className="text-purple-600" /> 물질이 뜨거나 가라앉는 것과 밀도의 관계 알아보기
                        </h2>
                        <p className="text-gray-600">액체를 넣어보고 어떤 것이 뜨고 가라앉는지 관찰해보세요.</p>
                    </div>
                    <div className="w-full max-w-5xl flex flex-col md:flex-row items-start justify-center gap-8">
                        <div className="flex flex-col items-center">
                            <div className={`w-32 h-64 border-4 border-gray-300 rounded-b-2xl bg-white relative overflow-hidden shadow-xl mb-2 ${isMixing ? 'mixing' : ''}`}>
                                <div className="absolute bottom-0 w-full flex flex-col-reverse transition-all">
                                    {layers.map((l, idx) => (
                                        <div key={idx} className="w-full flex items-center justify-center liquid-layer" 
                                            style={{ 
                                                height: '40px', 
                                                backgroundColor: l.color, 
                                                color: l.textColor, 
                                                opacity: 0.9,
                                                transform: isMixing ? `translateY(${Math.sin(idx)*5}px)` : 'none' // Simple visual disturbance
                                            }}>
                                            <span className="text-xs font-bold drop-shadow-md">{l.name}</span>
                                        </div>
                                    ))}
                                </div>
                                {isMixing && <div className="absolute inset-0 flex items-center justify-center bg-white bg-opacity-30 text-gray-800 font-bold animate-pulse">섞이는 중...</div>}
                            </div>
                            <span className="text-sm font-bold text-gray-500">실험용 컵</span>
                        </div>
                        <div className="flex-1 flex flex-col gap-6 w-full">
                            <div className="bg-white p-4 rounded-xl shadow-md">
                                <h3 className="font-bold text-gray-700 mb-2">1단계: 액체 관찰하기 (클릭하여 컵에 넣기)</h3>
                                <div className="flex flex-wrap gap-2">
                                    {availableLiquids.map(l => (
                                        <button key={l.id} onClick={() => addToTower(l)} disabled={isMixing}
                                            className="px-3 py-2 rounded-lg border hover:bg-gray-50 text-sm disabled:opacity-50" 
                                            style={{ borderLeft: `4px solid ${l.color}` }}>
                                            {l.name}
                                        </button>
                                    ))}
                                    <button onClick={resetAll} className="ml-auto text-xs text-red-500 underline">비우기</button>
                                </div>
                            </div>
                            <div className="bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-md">
                                <h3 className="font-bold text-blue-900 mb-4 text-center">2단계: 밀도 순서 맞추기 (밀도가 큰 순서대로)</h3>
                                <div className="flex flex-wrap items-center justify-center gap-2 mb-6">
                                    {userSequence.map((slot, idx) => (
                                        <React.Fragment key={idx}>
                                            <div onClick={() => removeFromSequence(idx)} className={`w-20 h-24 rounded-lg border-2 border-dashed flex flex-col items-center justify-center cursor-pointer bg-white relative ${slot ? 'border-solid border-gray-400' : 'border-gray-300'}`}>
                                                {slot ? (
                                                    <>
                                                        <div className="w-full h-full absolute inset-0 rounded-lg opacity-20" style={{backgroundColor: slot.color}}></div>
                                                        <span className="font-bold text-gray-800 z-10 text-xs text-center">{slot.name}</span>
                                                        {isSuccess && <div className="absolute bottom-1 bg-white px-1 rounded text-[10px] font-bold text-blue-600 shadow-sm z-10">{slot.density}</div>}
                                                    </>
                                                ) : <span className="text-gray-300 text-2xl font-bold">{idx + 1}</span>}
                                            </div>
                                            {idx < 2 && <span className="text-gray-400 font-bold text-xl">&gt;</span>}
                                        </React.Fragment>
                                    ))}
                                </div>
                                <div className="flex flex-wrap justify-center gap-2 mb-4">
                                    {availableLiquids.map(l => (
                                        <button key={l.id} onClick={() => addToSequence(l)} disabled={userSequence.some(s => s && s.id === l.id) || isSuccess} 
                                            className="px-3 py-2 rounded border text-sm font-medium bg-white hover:bg-blue-50 disabled:opacity-30">
                                            {l.name}
                                        </button>
                                    ))}
                                </div>
                                {message && <div className={`text-center font-bold p-3 rounded-lg ${isSuccess ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-600'}`}>{message}</div>}
                                <button onClick={resetAll} className="mt-4 w-full py-2 bg-gray-700 text-white rounded text-sm">초기화</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Tab 3: Examples ---
        const DiverGame = () => {
            const [weights, setWeights] = useState(0); 
            const [status, setStatus] = useState('surface_float'); 
            const [depth, setDepth] = useState(15); 
            const [isDiving, setIsDiving] = useState(false);

            const dive = () => {
                setIsDiving(true);
                if (weights === 0) { setDepth(12); setStatus('surface_float'); }
                else if (weights === 1) { setDepth(28); setStatus('shallow'); }
                else if (weights === 2) { setDepth(50); setStatus('neutral'); } 
                else if (weights === 3) { setDepth(70); setStatus('deep'); }
                else if (weights === 4) { setDepth(85); setStatus('floor'); }
                else { setDepth(92); setStatus('floor_heavy'); }
            };

            const getStatusText = () => {
                switch(status) {
                    case 'surface_float': return "밀도가 작아 물 위에 떠 있습니다.";
                    case 'shallow': return "가라앉기 시작했지만 수심이 얕습니다.";
                    case 'neutral': return "성공! 15m 지점에 안전하게 멈췄습니다.";
                    case 'deep': return "밀도가 커서 바닥으로 가라앉는 중입니다.";
                    case 'floor':
                    case 'floor_heavy': return "밀도가 너무 커서 바닥에 닿았습니다!";
                    default: return "";
                }
            };

            return (
                <div className="flex flex-col h-full p-4 gap-6 bg-slate-100">
                    <div className="flex flex-col md:flex-row gap-6 h-full">
                        <div className="flex-1 rounded-2xl overflow-hidden relative shadow-2xl ocean-gradient border-4 border-slate-300">
                            <div className="absolute top-0 left-0 w-full h-[15%] bg-sky-200"></div>
                            
                            <div className="absolute left-10 top-[2%] z-10"><SimpleShip /></div>
                            <div className="absolute right-1/4 top-[8%] z-10"><LifeJacketPerson /><div className="text-[10px] font-bold text-orange-600 bg-white px-1 rounded text-center -mt-2">구명조끼</div></div>
                            
                            <div className="absolute right-0 h-full w-12 bg-black bg-opacity-20 flex flex-col justify-between py-4 text-white text-[10px] font-mono text-center z-10 pt-16 pb-4">
                                <span>0m</span><span>5m</span><span>10m</span><span className="text-yellow-300 font-bold border-y border-yellow-300">15m</span><span>20m</span><span>25m</span><span>30m</span>
                            </div>

                            <div className="absolute left-1/2 transform -translate-x-1/2 diver-anim z-20" style={{ top: `${depth}%`, marginTop: '-60px' }}>
                                <RealisticDiver weightCount={weights} />
                                {isDiving && (
                                    <div className="absolute -left-24 top-1/2 -translate-y-1/2 bg-white bg-opacity-95 px-3 py-1 rounded-full shadow-lg border border-blue-200 whitespace-nowrap animate-pulse">
                                        <span className={`text-xs font-bold ${status === 'neutral' ? 'text-green-600' : 'text-slate-700'}`}>{getStatusText()}</span>
                                    </div>
                                )}
                            </div>
                            <div className="absolute bottom-0 left-0 w-full h-4 bg-orange-200 opacity-60"></div>
                        </div>

                        <div className="md:w-80 bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-between border border-slate-200">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800 mb-2 flex items-center gap-2"><Waves className="text-blue-600" /> 생활 속에서 밀도를 이용하는 예</h2>
                                <p className="text-slate-600 text-sm mb-6 leading-relaxed"><strong>미션:</strong> 납 벨트의 수를 조절하여 잠수부를 <span className="text-blue-600 font-bold underline">수심 15m 지점</span>에 정확히 멈춰보세요!</p>
                                <div className="bg-blue-50 p-4 rounded-xl mb-6 border border-blue-100">
                                    <h3 className="font-bold text-center mb-4 text-blue-900">납 벨트의 수</h3>
                                    <div className="flex items-center justify-between px-4">
                                        <button onClick={() => {setWeights(Math.max(0, weights - 1)); setIsDiving(false);}} className="w-10 h-10 bg-white border border-red-200 text-red-500 rounded-full font-bold shadow-sm">-</button>
                                        <div className="text-center"><span className="text-4xl font-bold text-slate-700">{weights}</span><div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">개</div></div>
                                        <button onClick={() => {setWeights(Math.min(5, weights + 1)); setIsDiving(false);}} className="w-10 h-10 bg-white border border-green-200 text-green-500 rounded-full font-bold shadow-sm">+</button>
                                    </div>
                                </div>
                            </div>
                            <button onClick={dive} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2"><CircleDashed size={20} className={isDiving ? "animate-spin" : ""} /> 잠수 시작!</button>
                            <div className="mt-4 p-4 bg-gray-50 rounded-lg text-xs text-gray-700 border border-gray-200 leading-relaxed">
                                <strong>잠수부</strong>는 물속에 쉽게 가라앉기 위해 납이 달린 허리띠를 차고 잠수한다. <strong>구명조끼</strong>를 입으면 물보다 밀도가 작아져 물에 가라앉지 않는다.
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('experiment');
            return (
                <div className="min-h-screen flex flex-col max-w-6xl mx-auto shadow-2xl my-0 lg:my-8 bg-white lg:rounded-3xl overflow-hidden">
                    <header className="bg-slate-800 text-white p-4 flex flex-col md:flex-row justify-between items-center z-20 gap-4">
                        <div className="flex items-center gap-3"><div className="bg-blue-500 p-2 rounded-lg"><Beaker className="text-white" size={24} /></div><h1 className="text-xl font-bold tracking-tight">가상 과학 실험실 : I. 물질의 특성 - 1. 밀도</h1></div>
                        <div className="flex flex-wrap justify-center bg-slate-700 rounded-lg p-1 gap-1">
                            <button onClick={() => setActiveTab('experiment')} className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${activeTab === 'experiment' ? 'bg-blue-500 text-white shadow' : 'text-gray-300 hover:text-white'}`}>1. 탐구</button>
                            <button onClick={() => setActiveTab('tower')} className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${activeTab === 'tower' ? 'bg-purple-500 text-white shadow' : 'text-gray-300 hover:text-white'}`}>2. 해 보기</button>
                            <button onClick={() => setActiveTab('diver')} className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${activeTab === 'diver' ? 'bg-teal-500 text-white shadow' : 'text-gray-300 hover:text-white'}`}>3. 생활 속에서 밀도를 이용하는 예</button>
                        </div>
                    </header>
                    <main className="flex-1 bg-gray-50 overflow-y-auto" style={{minHeight: '600px'}}>{activeTab === 'experiment' && <ExperimentLab />}{activeTab === 'tower' && <DensityTower />}{activeTab === 'diver' && <DiverGame />}</main>
                    <footer className="bg-white border-t p-4 text-center text-gray-500 text-xs font-medium italic">중학교 과학 2학년 [물질의 특성] 단원 보조 실험 자료</footer>
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
